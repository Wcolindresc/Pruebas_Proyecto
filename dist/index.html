<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>La Bodegona Demo — Inicio</title>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="./assets/config.js"></script>
  <script src="./assets/common.js"></script>
  <script>
  async function loadHome(){
    const hero = qs('#hero');
    hero.innerHTML = `<div class="banner">Mega Promo de Octubre</div>`;

    try{
      const cats = await fetchJSON('/api/categories');
      qs('#cats').innerHTML = cats.slice(0,12).map(c=>`
        <a class="card cat" href="./categoria.html?slug=${c.slug}">
          <div class="imgwrap"><img src="${c.image || (window.__BASE__+'assets/placeholder.webp')}" alt="${c.name}"></div>
          <div class="info"><div class="title">${c.name}</div></div>
        </a>`).join('');
    }catch{
      const ph = window.__BASE__+'assets/placeholder.webp';
      qs('#cats').innerHTML = ['Celulares','Laptops','Audio','Gaming','Hogar','Herramientas','Libros','Mascotas','Oficina','TV & Video','Accesorios','Deportes']
        .map(n=>`<a class="card cat" href="./categoria.html?slug=${n.toLowerCase()}"><div class="imgwrap"><img src="${ph}" alt="${n}"></div><div class="info"><div class="title">${n}</div></div></a>`).join('');
    }

    for (const blk of [
      {id:'new', title:'Lo + nuevo', query:'/api/products?sort=new&limit=12'},
      {id:'deals', title:'Ofertas', query:'/api/products?tag=offer&limit=12'},
      {id:'reco', title:'Recomendados', query:'/api/products?tag=recommended&limit=12'}
    ]){
      try{
        const data = await fetchJSON(blk.query);
        qs(`#${blk.id} .grid.cards`).innerHTML = data.items.map(productCard).join('');
      }catch(e){ qs(`#${blk.id} .grid.cards`).innerHTML = '<p>No hay productos.</p>'; }
    }
  }
  window.addEventListener('DOMContentLoaded', loadHome);
  </script>
</head>
<body>
  <header id="site-header"></header>
  <main class="container">
    <section class="hero section" id="hero"></section>

    <section class="section">
      <h2>Categorías destacadas</h2>
      <div id="cats" class="grid cards"></div>
    </section>

    <section id="new" class="section">
      <h2>Lo + nuevo</h2>
      <div class="grid cards"></div>
    </section>

    <section id="deals" class="section">
      <h2>Ofertas</h2>
      <div class="grid cards"></div>
    </section>

    <section id="reco" class="section">
      <h2>Recomendados</h2>
      <div class="grid cards"></div>
    </section>
  </main>
  <footer id="site-footer"></footer>
</body>
</html>

